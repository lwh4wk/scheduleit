<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>cs 4640 project</title>

    <meta name="author" content="Logan Hylton, LavontÃ© Brown">
    <meta name='description' content="cs4640 project">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">  <!-- required to handle IE -->

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="styles/mystyle.css" />

    <!-- required scripts for IE -->
    <!--[if lt IE 9]-->
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


    <script type="text/javascript">
        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function() {
            if (xhr.status == 200) {
                if (xhr.responseText == "false") {
                    window.location.href = "home.html";
                }
            }
        }

        xhr.open('POST', 'checkUser.php', true);

        xhr.send();

    </script>

    <style>
        .hover-ref {
            width: auto;
            height: auto;
            transition: font-size 0.5s, color 0.5s, transform 0.5s;
        }
        .hover-ref:hover {
            font-size: 20px;
            color: lawngreen;
        }
        .navbar-brand {
            font-color: white;
            transition: font-color 0.5s, font-size 0.5s;
        }

        .navbar-brand:hover {
            font-size: 30px;
        }
    </style>

</head>

<body style="background-color: #ffbf80">

<header>
    <nav class="navbar navbar-expand-md bg-dark navbar-dark">
        <a class="navbar-brand" href="http://localhost/cs4640project/calendar.html">Schedule It!</a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse justify-content-end" id="collapsibleNavbar">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="calendar.html">Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="classes.html">Manage Classes</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="assignments.html">Manage Assignments</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="#">Manage Account</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="signout.php">Sign Out</a>
                </li>
            </ul>
        </div>
    </nav>
</header>

<div class="jumbotron rounded-0" style="padding: 2%; background: #007bff; color: white;">
    <div class="container">
        <h1 align="center">Manage Account</h1>
    </div>
</div>

<div class="row">
    <div class="col-md-2 col-lg-3"></div>
    <div class="col-md-8 col-lg-6 col-sm-12 justify-content-center align-content-center d-flex">
        <ul class="list-group rounded-lg">
            <li class="list-group-item">
                <div id="fname">First Name:&nbsp&nbsp</div>
            </li>
            <li class="list-group-item">
                <div id="lname">Last Name:&nbsp&nbsp</div>
            </li>
            <li class="list-group-item">
                <div id="user">Username:&nbsp&nbsp</div>
            </li>
            <li class="list-group-item">
                <div class="form-row">
                    <div style="padding: 5px;">
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
                            Change Password
                        </button>
                    </div>
                    <div style="padding: 5px;">
                        <button class="btn btn-danger" onclick="deleteAccount()">Delete Account</button>
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <div class="col-md-2 col-lg-3"></div>
</div>

<div style="padding-top: 10px;" class="align-content-center justify-content-center container d-flex" id="passResponse"></div>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Change Password</h5>
                <button type="button" class="close" id="closeModal" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="passwordForm">
                    <div class="form-group">
                        <label for="currentPassword">Enter Current Password: </label>
                        <input type="password" id="currentPassword" />
                    </div>
                    <hr/>
                    <div class="form-group">
                        <label for="newPassword">Enter New Password: </label>
                        <input type="password" id="newPassword"/>
                    </div>
                    <div class="form-group">
                        <label for="newPasswordConfirm">Confirm New Password: </label>
                        <input type="password" id="newPasswordConfirm"/>
                    </div>
                    <div class="form-group">
                        <div class="form-row">
                            <div style="padding: 5px;">
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                            </div>
                            <div style="padding: 5px;">
                                <button type="button" id="saveBtn" class="btn btn-primary" onclick="changePassword()" disabled>Save Changes</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<script>
    function deleteAccount() {
        if (confirm("Are your sure you wish to delete this account? This will remove all classes and assignments.") == true) {
            window.location.href = "removeAccount.php";
        }
    }

    document.getElementById("currentPassword").oninput = function() {
        checkEntered();
    };
    document.getElementById("newPassword").oninput = function() {
        checkEntered();
    };
    document.getElementById("newPasswordConfirm").oninput = function() {
        checkEntered();
    };

    function checkEntered() {
        if (document.getElementById("currentPassword").value != '' && document.getElementById("newPassword").value != '') {
            checkMatching();
        } else {
            document.getElementById("saveBtn").disabled = true;
        }
    }

    function checkMatching() {
        if (document.getElementById("newPassword").value == document.getElementById("newPasswordConfirm").value) {
            document.getElementById("saveBtn").disabled = false;
        } else {
            document.getElementById("saveBtn").disabled = true;
        }
    }

    function changePassword() {
        var currentPass = document.getElementById("currentPassword").value;
        document.getElementById("currentPassword").value = "";
        var newPass = document.getElementById("newPassword").value;
        document.getElementById("newPassword").value = "";

        var changePasswordXhr = new XMLHttpRequest();

        changePasswordXhr.onload = function() {
            if (changePasswordXhr.status === 200) {
                console.log(changePasswordXhr.responseText);
                if (changePasswordXhr.responseText == "success") {
                    document.getElementById("passResponse").innerHTML = "<p class=\"alert alert-success\" id=\"passSuccess\">Your password has successfully been changed.</p>";
                } else {
                    document.getElementById("passResponse").innerHTML = "<p class=\"alert alert-danger\" id=\"passError\">The password you entered doesn't match our records.</p>";
                }
                document.getElementById("closeModal").click();
            }
        }

        changePasswordXhr.open('POST', 'changePassword.php', true);
        changePasswordXhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        changePasswordXhr.send("current=" + currentPass + "&new=" + newPass);
    }

    document.getElementsByTagName('body')[0].onload = function() {
        var loadAccountXhr = new XMLHttpRequest();

        loadAccountXhr.onload = function() {
            if (loadAccountXhr.status === 200) {
                var response = JSON.parse(loadAccountXhr.responseText);
                document.getElementById("fname").innerText += response.fname;
                document.getElementById("lname").innerText += response.lname;
                document.getElementById("user").innerText += response.username;
            }
        }

        loadAccountXhr.open('GET', 'loadAccountInfo.php', true);
        loadAccountXhr.send(null);
    }
</script>

</body>
</html>




















